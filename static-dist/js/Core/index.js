define("Core/Hub",[],function(e,t,n){function i(){return r||(r={},_.extend(r,Backbone.Events)),r}var r=null;return{getInstance:i}}),define("Core/svg",[],function(e,t,n){var r="http://www.w3.org/2000/svg";t.create=function(e){return document.createElementNS(r,e)},t.attr=function(e,t,n){var r=t;_.isString(t)&&(r={},r[t]=n),_.each(r,function(t,n){e.setAttributeNS(null,n,t)})}}),define("Core/Assets/index",["./Geometry","./Material","./Shader","./FileSystem","./Prefab","./Texture","./TextureCube","./Util","./Importer/index","./Importer/Binary","./Importer/Collada","./Importer/JSON","./Importer/Zip","./Importer/Image","./Importer/DDS"],function(e,t,n){t.Geometry=e("./Geometry"),t.Material=e("./Material"),t.Prefab=e("./Prefab"),t.Shader=e("./Shader"),t.Texture=e("./Texture"),t.TextureCube=e("./TextureCube"),t.FileSystem=e("./FileSystem"),t.Util=e("./Util"),t.Importer=e("./Importer/index")}),define("Core/Assets/Geometry",[],function(e,t,n){function s(e){var t=e&&e.name,n={type:"geometry",name:t||"Geometry_"+i++,data:e||null,host:null,"import":function(e){return this.data=o(e),this.data.host=this,e.name&&(this.name=e.name),this.data},"export":function(){return f(this.data)},getInstance:function(e){return u(this.data,e)},getCopy:function(){return a(this.data)},getPath:function(){if(this.host)return this.host.getPath()}};return e&&(e.host=n),n}function o(e){var t;return r.createModel(e,function(e){t=e}),t}function u(e,t){t||(t=new THREE.MeshLambertMaterial({wireframe:!0,color:16777215*Math.random()}),t.__system__=!0),t.map&&(e.uvsNeedUpdate=!0),e.__referencecount__||(e.__referencecount__=0);var n=new THREE.Mesh(e,t);return n.name=e.name+"_"+e.__referencecount__,e.__referencecount__++,n}function a(e){var t=new THREE.Geometry;return _.extend(t,{vertices:e.vertices,faces:e.faces,faceVertexUvs:e.faceVertexUvs,boundingBox:e.boundingBox}),t}function f(e){var t,n,r={name:e.name,metadata:{formatVersion:3.1},scale:1,materials:[],vertices:[],morphTargets:[],morphColors:[],normals:[],colors:[],uvs:[[]],faces:[]};for(t=0;t<e.vertices.length;t++)r.vertices.push(e.vertices[t].x),r.vertices.push(e.vertices[t].y),r.vertices.push(e.vertices[t].z);for(var t=0;t<e.materials.length;t++)r.materials[t]=materialBaseUri+e.materials[t].name;var i,s,o,u,a,f,l,c,h,p,d,v;e.faceVertexUvs[0].length?o=1:o=0,e.faceUvs[0].length?i=1:i=0;for(t=0;t<e.faces.length;t++){h=e.faces[t],_.isUndefined(h.materialIndex)?s=0:s=1,h instanceof THREE.Face4?(p=4,u=1):(p=3,u=0),h.normal?a=1:a=0,h.vertexNormals.length?f=1:f=0,l=0,h.vertexColors.length?c=1:c=0,v=u|s<<1|i<<2|o<<3|a<<4|f<<5|l<<6|c<<7,r.faces.push(v),r.faces.push(h.a),r.faces.push(h.b),r.faces.push(h.c),u&&r.faces.push(h.d),s&&r.faces.push(h.materialIndex),i&&(r.uvs[0].push(e.faceUvs[0][t].u),r.uvs[0].push(e.faceUvs[0][t].v),r.faces.push(r.uvs[0].length/2-1));if(o)for(n=0;n<p;n++)r.uvs[0].push(e.faceVertexUvs[0][t][n].u),r.uvs[0].push(e.faceVertexUvs[0][t][n].v),r.faces.push(r.uvs[0].length/2-1);a&&(r.normals.push(h.normal.x),r.normals.push(h.normal.y),r.normals.push(h.normal.z),r.faces.push(r.normals.length/3-1));if(f)for(n=0;n<p;n++)r.normals.push(h.vertexNormals[n].x),r.normals.push(h.vertexNormals[n].y),r.normals.push(h.vertexNormals[n].z),r.faces.push(r.normals.length/3-1);l&&(r.colors.push(h.color.getHex()),r.faces.push(r.colors.length-1));if(c)for(n=0;n<p;n++)r.colors.push(h.vertexColors[n].getHex()),r.faces.push(r.colors.length-1)}return r}var r=new THREE.JSONLoader,i=0;t.create=s,t.export=f,t.getInstance=u,t.getCopy=a}),define("Core/Assets/Material",["./Shader","./FileSystem"],function(e,t,n){function o(e){var t=e&&e.name,n;if(!e.shader){if(e instanceof THREE.MeshPhongMaterial){var i=r.buildin["buildin-phong"].getInstance();n=new THREE.ShaderMaterial,a(n,i)}else if(e instanceof THREE.MeshLambertMaterial){var i=r.buildin["buildin-lambert"].getInstance();n=new THREE.ShaderMaterial,a(n,i)}else if(e instanceof THREE.MeshBasicMaterial){var i=r.buildin["buildin-basic"].getInstance();n=new THREE.ShaderMaterial,a(n,i)}else if(e instanceof THREE.ShaderMaterial){n=e;var o=r.create(new r.Shader({uniforms:e.uniforms,fragmentShader:e.fragmentShader,vertexShader:e.vertexShader}));a(e,o.data)}n.name=e.name}else n=e;var h={type:"material",name:t||"Material_"+s++,data:n||null,host:null,"import":function(e,t){return this.data=u(e,t),this.data.host=this,e.name&&(this.name=e.name),this.data},bindShader:function(e){a(this.data,e)},"export":function(){return f(this.data)},getInstance:function(){return this.data},getCopy:function(){return l(this.data)},getConfig:function(){return c(this.data)},getPath:function(){if(this.host)return this.host.getPath()}};return n&&(n.host=h),h}function u(e){return material}function a(e,t){t=r.getInstance(t),e.shader=t,e.uniforms=t.uniforms,e.fragmentShader=t.fragmentShader,e.vertexShader=t.vertexShader,e.needsUpdate=!0}function f(e){var t={name:e.name,shader:this.shader.host.getPath()};return t}function l(e){var e=new THREE.ShaderMaterial;return clonedMaterial}function c(e){var t={name:{type:"input",value:e.name,onchange:function(t){e.name=t,e.host.name=t,e.host.host.setName(t)}},shader:{type:"select",options:[{value:"buildin-basic",description:"Buildin Basic"},{value:"buildin-lambert",description:"Buildin Lambert"},{value:"buildin-phong",description:"Buildin Phong"},{value:"custom",description:"custom"}],value:function(){var t=e.shader.host.getPath();return r.buildin[t]?t:"custom"}(),onchange:function(t,n){r.buildin[t]?a(e,r.buildin[t].getInstance()):a(e,i.root.find(t)),n&&n("Shader Asset")}}};return{"Material Asset":{type:"layer",sub:t},"Shader Asset":{type:"layer",sub:{}}}}var r=e("./Shader"),i=e("./FileSystem"),s=0;t.create=o,t.export=f,t.bindShader=a,t.getCopy=l}),define("Core/Assets/Shader",[],function(e,t,n){function i(e){var t=e&&e.name,n={type:"shader",name:t||"Shader_"+r++,data:e||null,host:null,"import":function(e,t){return this.data=c(e,t),this.data.host=this,e.name&&(this.name=e.name),this.data},"export":function(){return h(this.data)},getInstance:function(){return p(this.data)},getCopy:function(){return d(this.data)},getConfig:function(){return getConfig(this.data)},getPath:function(){return this.host?this.host.getPath():this.name}};return e&&(e.host=n),n}function s(e,t){}function o(e){return e.replace(/{{(.*?)}}/,f)}function u(e){var t={},n=e.match(/uniform\s*\S*\s*\S*\s*;/);return _.each(n,function(e){var t=e.split(" "),n=l(t[1]),r=l(t[2]);unfiroms[r]={type:a[n]}}),t}function f(e,t,n,r){return THREE.ShaderChunk[t]}function l(e){return e.replace(/(^\s*)|(\s*$)/g,"")}function c(e,t){var n={};_.each(e.uniforms,function(e,n){var r;switch(e.type){case"f":case"i":r=e.value;break;case"fv":case"fv1":case"iv":case"iv1":r=unifom.value;break;case"v2":r=new THREE.Vector2,r.set.apply(r,e.value);break;case"v2v":r=[],_.each(e.value,function(e){var t=new THREE.Vector2;t.set.apply(t,e.value),r.push(t)});break;case"v3":r=new THREE.Vector3,r.set.apply(r,e.value);break;case"v3v":r=[],_.each(e.value,function(e){var t=new THREE.Vector3;t.set.apply(t,e.value),r.push(t)});break;case"v4":r=new THREE.Vector4,r.set.apply(r,e.value);break;case"v4v":r=[],_.each(e.value,function(e){var t=new THREE.Vector4;t.set.apply(t,e.value),r.push(t)});break;case"m3":r=new THREE.Matrix3,r.set.apply(r,e.value);break;case"m4":r=new THREE.Matrix4,r.set.apply(r,e.value);break;case"m4v":r=[];break;case"t":r=t(e.value);break;case"tv":var r=[];_.each(e.value,function(e){r.push(t(e))});break;case"c":r=new THREE.Color(e.value);break;default:r=0}unfiorms[n]={type:e.type,value:r}});var r=new Shader({uniforms:n,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader});return r.name=e.name,r}function h(e){var t={};return t.name=e.name,t.uniforms={},_.each(e.uniforms,function(e,n){var r;switch(e.type){case"f":case"i":r=e.value;break;case"fv":case"fv1":case"iv":case"iv1":r=unifom.value;break;case"v2":r=[e.value.x,e.value.y];break;case"v2v":var r=[];_.each(e.value,function(e){r.push([e.x,e.y])});break;case"v3v":var r=[];_.each(e.value,function(e){r.push([e.x,e.y,e.z])});break;case"v4v":var r=[];_.each(e.value,function(e){r.push([e.x,e.y,e.z,e.w])});break;case"v3":r=[e.value.x,e.value.y,e.value.z];break;case"v4":r=[e.value.x,e.value.y,e.value.z,e.value.w];break;case"m3":r=e.value.flattenToArray();break;case"m4":r=unfiorm.value.flattenToArray();break;case"m4v":r=[];break;case"t":r=e.value.host.getPath();break;case"tv":var r=[];_.each(e.value,function(e){r.push(e.host.getPath())});break;case"c":r=e.value.getHex();break;default:r=0}t.uniforms[n]={type:e.type,value:r}}),t.vertexShader=e.vertexShader,t.fragmentShader=e.fragmentShader,t}function p(e){var t=e.clone();return t.host=e.host,t}function d(e){var t=e.clone();return _.each(t.uniforms,function(e,t){e.type=="t"&&e.value&&(e.value=e.value.host.getCopy(),e.value.needsUpdate=!0),e.type=="tv"&&e.value&&_.each(e.value,function(t,n){e.value[n]=t.host.getCopy(),e.value[n].needsUpdate=!0})}),t}var r=0;Shader=function(e){this.uniforms=e.uniforms,this.vertexShader=o(e.vertexShader),this.fragmentShader=o(e.fragmentShader)},Shader.prototype.clone=function(){var e={},t=this;return _.each(this.uniforms,function(n,r){e[r]={type:n.type,value:t.cloneValue(n.value)}}),new Shader({uniforms:e,fragmentShader:this.fragmentShader,vertexShader:this.vertexShader})},Shader.prototype.cloneValue=function(e){var t=this;if(_.isArray(e)){var n=[];return _.each(e,function(e,r){n[r]=t.cloneValue(e)}),n}return e instanceof THREE.Color||e instanceof THREE.Vector2||e instanceof THREE.Vector3||e instanceof THREE.Vector4||e instanceof THREE.Matrix4?e.clone():e};var a={"float":"f",vector2:"v2",vector3:"v3",vector4:"v4",mat4:"m4v"};t.create=i,t.export=h,t.getInstance=p,t.getCopy=d,t.Shader=Shader,t.buildin={};var v=new Shader(THREE.ShaderLib.basic);v.name="buildin-basic",t.buildin["buildin-lambert"]=t.create(v);var m=new Shader(THREE.ShaderLib.phong);m.name="buildin-phong",t.buildin["buildin-phong"]=t.create(m);var g=new Shader(THREE.ShaderLib.lambert);g.name="buildin-lambert",t.buildin["buildin-lambert"]=t.create(g)}),define("Core/Assets/FileSystem",[],function(e,t,n){var r=function(e,t){this.type="file",this.name=e||"",this.data=null,t&&this.attach(t,!0),this.parent=null};_.extend(r.prototype,Backbone.Events),r.prototype.getRoot=function(){var e=this;while(e.parent)e=e.parent;return e},r.prototype.setName=function(e,t){t||this.getRoot().trigger("updated:name",this,e),this.name=e},r.prototype.attach=function(e,t){this.data=e,e.host=this,t||this.getRoot().trigger("attached:asset",this,e)},r.prototype.detach=function(e){this.data=null,asset.host=null,e||this.getRoot().trigger("detached:asset",this)},r.prototype.getPath=function(){return this.parent?this.parent.getPath()+this.name:this.name};var i=function(e){this.name=e||"",this.type="folder",this.children=[]};_.extend(i.prototype,Backbone.Events),i.prototype.setName=function(e,t){t||this.getRoot().trigger("updated:name",this,e),this.name=e},i.prototype.getRoot=function(){var e=this;while(e.parent)e=e.parent;return e},i.prototype.add=function(e,t){var n=!1;if(e.parent){n=!0;if(e.parent==this)return;e.parent.remove(e,!0)}this.children.push(e);if(n)var r=e.parent;e.parent=this,t||(n?this.getRoot().trigger("moved:node",this,r,e):this.getRoot().trigger("added:node",this,e))},i.prototype.remove=function(e,t){_.isString(e)&&(e=this.find(e)),t||this.getRoot().trigger("removed:node",this,e),e.parent=null,_.without(this.children,e)},i.prototype.traverse=function(e){e&&e(this),_.each(this.children,function(t){t.traverse(e)})},i.prototype.getPath=function(){return this.parent?this.parent.getPath()+this.name+"/":this.name+"/"},i.prototype.find=function(e){var n=this;return e.charAt(0)=="/"&&(e=e.substring(1),n=t.root),_.reduce(_.compact(e.split("/")),function(e,t){if(!e)return;return t==".."?e.parent:t=="."?e:_.find(e.children,function(e){return e.name==t})},n)},i.prototype.createFolder=function(e,t){e=_.compact(e.split("/"));var n=_.reduce(e,function(e,n){var r=e.find(n);return r||(r=new i(n),e.add(r,t)),r},this);return t||this.getRoot().trigger("created:folder",this,n),n},i.prototype.createFile=function(e,t,n){dir=_.compact(e.split("/"));var i=dir.pop(),s=this.createFolder(dir.join("/"),n),o=s.find(i);return o||(o=new r(i,t),s.add(o,n),n||this.getRoot().trigger("created:file",this,o)),o};var s=function(){i.call(this)};s.prototype=new i,s.prototype.getPath=function(){return"/"},t.root=new s,t.Folder=i,t.File=r}),define("Core/Assets/Prefab",["./Geometry","./Material","./Shader","./FileSystem","./Texture","./TextureCube","./Util"],function(e,t,n){function f(e){var t=e&&e.name,n={type:"prefab",name:t||"Mesh_"+a++,data:e||null,rawdata:"",host:null,"import":function(e,t,n){return this.data=h(e,t,n),this.rawdata=e,e.name&&(this.name=e.name),this.data},"export":function(){return p(this.data)},getInstance:function(){return d(this.data)},getCopy:function(){return v(this.data)},getConfig:function(){return m(this.data)},getPath:function(){if(this.host)return this.host.getPath()}};return e&&(e.host=n),n}function h(e,t,n){var r={};return _.each(e,function(e){var i=new l[e.type];i.name=e.name,i.parent=e.parent;var s=_.union(c[e.type],c.node);_.each(s,function(r){var s=e[r];if(!s)return;_.isNumber(s)?i[r]=s:r=="material"?i.material=t(s):r=="geometry"?i.geometry=n(s):s.length==2?i[r]=new THREE.Vector2(s[0],s[1]):s.length==3?i[r]=new THREE.Vector3(s[0],s[1],s[2]):s.length==4&&(i[r]=new THREE>Vector4(s[0],s[1],s[2],s[3]))}),i instanceof THREE.Light&&(i.color=new THREE.Color(e.color)),r[e.name]=i}),_.each(r,function(e,t){if(e.parent){var n=r[e.parent];e.parent=n,n.add(e)}}),r}function p(e){var t={};return e.traverse(function(e){if(e.__helper__)return;if(!e.name)return;var n={};n.name=e.name,e.parent&&(n.parent=e.parent.name),t[e.name]=n,_.each(l,function(t,r){if(e instanceof t){n.type||(n.type=r);var i=c[r];_.each(i,function(t){var r=e[t];r instanceof THREE.Vector2?n[t]=[r.x,r.y]:r instanceof THREE.Vector3?n[t]=[r.x,r.y,r.z]:r instanceof THREE.Vector4?n[t]=[r.x,r.y,r.z,r.w]:r instanceof THREE.Color?n[t]=r.getHex():_.isNumber(r)||_.isString(r)?n[t]=r:r instanceof THREE.Material?n[t]=r.host.getPath():r instanceof THREE.Geometry&&(n[t]=r.host.getPath())})}})}),t}function d(e){var t=u.deepCloneNode(e);return t.host=e.host,t.traverse(function(n){var r=n.name,i=e.getChildByName(r,!0);n==t&&(i=e),i.__referencecount__||(i.__referencecount__=0),n.name=r+"_"+i.__referencecount__++}),t}function v(e){var t={},n=u.deepCloneNode(e);return n.traverse(function(e){if(!e.geometry)return;e.geometry=shallowCloneGeo(e.geometry),e.geometry.computeBoundingSphere(),e.material=shallowCloneMaterial(e.material)}),n}function m(e){return{"Prefab Asset":{type:"layer",sub:{name:{type:"input",value:e.name,onchange:function(t){e.name=t,e.host.name=t,e.host.host.setName(t)}}}}}}var r=e("./Geometry"),i=e("./Material"),s=e("./Texture"),o=e("./TextureCube"),u=e("./Util"),a=0,l={mesh:THREE.Mesh,directionalLight:THREE.DirectionalLight,pointLight:THREE.PointLight,ambientLight:THREE.AmbientLight,spotLight:THREE.SpotLight,perspectiveCamera:THREE.PerspectiveCamera,orthographicCamera:THREE.OrthographicCamera,scene:THREE.Scene,node:THREE.Object3D},c={mesh:["geometry","material"],directionalLight:["color","intensity"],pointLight:["color","intensity","distance"],ambientLight:["color"],spotLight:["intensity","distance","angle","exponent"],perspectiveCamera:["fov","aspect","near","far"],orthographicCamera:["left","right","top","bottom","near","far"],scene:[],node:["name","position","rotation","scale"]};t.create=f,t.export=p,t.getInstance=d,t.getCopy=v}),define("Core/Assets/Texture",[],function(e,n,r){function o(e){var t=e&&e.name,n={type:"texture",name:t||"Texture_"+s++,data:e||null,host:null,"import":function(e){return this.data=u(e),this.data.host=this,e.name&&(this.name=e.name),this.data},"export":function(){return a(this.data)},getInstance:function(){return f(this.data)},getCopy:function(){return l(this.data)},getConfig:function(){return c(this.data)},getPath:function(){if(this.host)return this.host.getPath()}};return e&&(e.host=n),n}function u(e){var n=new THREE.Texture({wrapS:t.wrapS,wrapT:t.wrapT,magFilter:t.magFilter,minFilter:t.minFilter,anisotropy:t.anisotropy,format:t.format,type:t.type,offset:new THREE.Vector2(t.offset[0],t.offset[1]),repeat:new THREE.Vector2(t.repeat[1],t.repeat[1])}),r=e.image;if(r.indexOf("data:image/")==0){var s=new Image;s.onload=function(){n.needsUpdate=!0},s.src=imageSrc,n.image=s}else if(r)if(i[r])n.image=i[r];else{var s=new Image;s.onload=function(){n.needsUpdate=!0},s.src=imageSrc,n.image=s,i[r]=s}return n}function a(e){var t={};return _.extend(t,{image:e.image.src,wrapS:e.wrapS,wrapT:e.wrapT,magFilter:e.magFilter,minFilter:e.minFilter,anisotropy:e.anisotropy,format:e.format,type:e.type,offset:[e.offset.x,e.offset.y],repeat:[e.repeat.x,e.repeat.y]}),t}function f(e){return e.needsUpdate=!0,e}function l(e){return e.clone()}function c(e){return{"Texture Asset":{type:"layer","class":"texture",sub:{name:{type:"input",value:e.name,onchange:function(t){e.name=t,e.host.name=t,e.host.host.setName(t)}},image:{type:"image",value:e.image,onchange:function(t){e.image=t,e.image.needsUpdate=!0}},mapping:{type:"select",value:e.mapping,options:[{value:1e3,description:"Repeat"},{value:1001,description:"Clamp to edge"},{value:1002,description:"Mirror"}],onchange:function(t){e.mapping=t,e.needsUpdate=!0}},magFilter:{type:"select",value:e.magFilter,options:h,onchange:function(t){e.magFilter=t}},minFilter:{type:"select",value:e.minFilter,options:h,onchange:function(){e.minFilter=value}},anisotropy:{type:"boolean",value:e.anisotropy,onchange:function(t){e.anisotropy=t}},offset:{type:"vector",value:{x:e.offset.x,y:e.offset.y},min:-100,max:100,step:.01,onchange:function(t,n){e.offset[t]=n}},repeat:{type:"vector",value:{x:e.repeat.x,y:e.repeat.y},min:0,max:1e3,step:.1,onchange:function(t,n){e.repeat[t]=n}}}}}}var i={},s=0,h=[{value:1003,description:"Nearst"},{value:1004,description:"Nearest MipMapNearest"},{value:1005,description:"Nearest MipMapLinear"},{value:1006,description:"Linear"},{value:1007,description:"Linear MipMapNearest"},{value:1008,description:"Linear MipMapLinear"}];n.create=o,n.export=a,n.getCopy=l}),define("Core/Assets/TextureCube",[],function(e,n,r){function o(e){var t=e&&e.name,n={type:"texturecube",name:t||"TextureCube_"+s++,data:e||null,host:null,"import":function(e){return this.data=u(e),this.data.host=this,e.name&&(this.name=e.name),this.data},"export":function(){return a(this.data)},getInstance:function(){return f(this.data)},getCopy:function(){return l(this.data)},getPath:function(){if(this.host)return this.host.getPath()}};return e&&(e.host=n),n}function u(e){var n=new THREE.Texture({wrapS:t.wrapS,wrapT:t.wrapT,magFilter:t.magFilter,minFilter:t.minFilter,anisotropy:t.anisotropy,format:t.format,type:t.type,offset:new THREE.Vector2(t.offset[0],t.offset[1]),repeat:new THREE.Vector2(t.repeat[1],t.repeat[1])}),r=0;return _.each(e.image.length,function(e,t){if(e.indexOf("data:image/")==0){var s=new Image;s.onload=function(){r--,r==0&&(n.needsUpdate=!0)},s.src=imageSrc,r++,n.image[t]=s}else if(e)if(i[e])n.image[t]=i[e];else{var s=new Image;s.onload=function(){r--,r==0&&(n.needsUpdate=!0)},s.src=imageSrc,r++,n.image[t]=s,i[e]=s}}),n}function a(e){var t={};return _.extend(t,{image:[],wrapS:e.wrapS,wrapT:e.wrapT,magFilter:e.magFilter,minFilter:e.minFilter,anisotropy:e.anisotropy,format:e.format,type:e.type,offset:[e.offset.x,e.offset.y],repeat:[e.repeat.x,e.repeat.y]}),_.each(e.image.length,function(e){t.image.push(e.src)}),t}function f(e){return e.needsUpdate=!0,e}function l(){return texture.clone()}var i={},s=0;n.create=o,n.export=a,n.getCopy=l}),define("Core/Assets/Util",[],function(e,t,n){t.splitGeometry=function(e){function p(e,t,n){return typeof e.__newindex__!="undefined"&&(t.vertices.push(e),e.__newindex__=t.vertices.length-1),typeof e.__materialindex__!="undefined"?e.__materialindex__=n:e.__materialindex__!=n&&(e=e.clone(),t.vertices.push(e),e.__newindex__=t.vertices.length-1,e.__materialindex__=n),e}var t=e.faces,n=e.faceVertexUvs[0],r=e.vertices,i,s,o,u,a,f,l=[],c;for(var h=0;h<t.length;h++)i=t[h],s=i.materialIndex,_.isUndefined(s)&&(s=0),l[s]||(l[s]={faces:[],vertices:[],uvs:[]}),c=l[s],c.faces.push(i),n[h]&&c.uvs.push(n[h]),o=r[i.a],u=r[i.b],a=r[i.c],o=p(o,c,s),i.a=o.__newindex__,u=p(u,c,s),i.b=u.__newindex__,a=p(a,c,s),i.c=a.__newindex__,i instanceof THREE.Face4&&(f=r[i.d],f=p(f,c,s),i.d=f.__newindex__);var d,v=[];for(var h=0;h<l.length;h++)d=new THREE.Geometry,d.vertices=l[h].vertices,d.faces=l[h].faces,d.faceVertexUvs=[l[h].uvs],d.name=e.name+"_sub_"+h,v.push(d);for(var h=0;h<l.length;h++)for(var m=0;m<l[h].vertices.length;m++)delete l[h].vertices[m].__newindex__,delete l[h].vertices[m].__materialindex__;return v},t.computeBoundingBox=function(e){function t(e){var n=[];e.geometry&&(e.geometry.boundingBox||e.geometry.computeBoundingBox(),n.push(e.geometry.boundingBox)),_.each(e.children,function(e,r){var i=t(e);n.push(i)});var r=new THREE.Vector3(1e5,1e5,1e5),i=new THREE.Vector3(-1e5,-1e5,-1e5);return _.each(n,function(e,t){e.max.x>i.x&&(i.x=e.max.x),e.max.y>i.y&&(i.y=e.max.y),e.max.z>i.z&&(i.z=e.max.z),e.min.x<r.x&&(r.x=e.min.x),e.min.y<r.y&&(r.y=e.min.y),e.min.z<r.z&&(r.z=e.min.z)}),{min:r,max:i}}return t(e)},t.deepCloneNode=function(e){var n=e.clone();return _.each(e.children,function(e){n.add(t.deepCloneNode(e))}),n},t.parseFileName=function(e){var t=e.split("."),n=t.pop(),r=t.join(".");return{ext:n,base:r}},t.getSceneNodePath=function(e){var t=e.name;while(e.parent)e=e.parent,t=e.name+"/"+t;return t},t.findSceneNode=function(e,n){if(e instanceof THREE.Object3D)return e;if(!_.isString(e))return;var r=n;return e.charAt(0)=="/"&&(e=e.substring(1),r=t.getRoot(r),e=e.substring(r.name.length)),_.reduce(_.compact(e.split("/")),function(e,t){if(!e)return;return e.getChildByName(t)},r)},t.getRoot=function(e){var t=e;while(e.parent)t=e.parent;return t}}),define("Core/Assets/Importer/index",["./Binary","../Geometry","../Prefab","../Material","../Shader","../FileSystem","../Texture","../TextureCube","../Util","./Collada","./JSON","./Zip","./Image","./DDS"],function(e,t,n){t.Binary=e("./Binary"),t.Collada=e("./Collada"),t.JSON=e("./JSON"),t.Zip=e("./Zip"),t.Image=e("./Image"),t.DDS=e("./DDS")}),define("Core/Assets/Importer/Binary",["../Geometry","../Prefab","../Material","../Shader","../FileSystem","../Texture","../TextureCube","../Util"],function(e,t,n){function u(e){geoList=o.splitGeometry(e);var t=new THREE.Object3D;return t.name=e.name,_.each(geoList,function(e,n){var r=i.getInstance(e);t.add(r)}),t}var r=new THREE.BinaryLoader,i=e("../Geometry"),s=e("../Prefab"),o=e("../Util");t.import=function(e,t,n){var i;r.createBinModel(t,function(e){i=e},"",[]),i.name=e;var o=u(i),a=s.create(o),f=n.createFile(a.name,a)},t.importFromFile=function(e,n,r){var i=new FileReader;i.onload=function(i){if(i.target.readyState==FileReader.DONE){var s=o.parseFileName(e.name).base,u=t.import(s,i.target.result,n);r&&r(u)}},i.readAsArrayBuffer(e)},t.importFromUrl=function(e,t){}}),define("Core/Assets/Importer/Collada",["../Geometry","../Prefab","../Material","../Shader","../FileSystem","../Texture","../TextureCube","../Util"],function(e,t,n){var r=new THREE.ColladaLoader,i=e("../Geometry"),s=e("../Prefab"),o=e("../Material"),u=e("../Util");t.import=function(e,t,n){var i=function(e){var t=n.find(e);t||(t=n.find("textures/"+e)),t||(e=e.split("/").pop(),t=n.find(e)),t||(t=n.find("textures/"+e));if(t)return t.data.getInstance()};r.parse(t,function(t){var r=new THREE.Object3D;_.each(t.scene.children,function(e){r.add(e)}),r.name=e;var i={};r.traverse(function(e){e.material&&(i[e.material.name]=e.material)});var u=n.createFolder("materials");_.each(i,function(e){var t=o.create(e),n=u.createFile(t.name,t)});var a=s.create(r),f=n.createFile(a.name,a)},i)},t.importFromFile=function(e,n,r){var i=new FileReader;i.onload=function(i){if(i.target.readyState==FileReader.DONE){var s=u.parseFileName(e.name).base,o=new DOMParser,a=o.parseFromString(i.target.result,"application/xml"),f=t.import(s,a,n);r&&r(f)}},i.readAsText(e)},t.importFromUrl=function(e,t,n){}}),define("Core/Assets/Importer/JSON",["../Geometry","../Prefab","../Material","../Shader","../FileSystem","../Texture","../TextureCube","../Util"],function(e,t,n){function a(e,t){geoList=u.splitGeometry(e);var n=new THREE.Object3D;return n.name=e.name,_.each(geoList,function(e,r){var s=i.getInstance(e,t[r]);n.add(s)}),n}function f(e,t){function n(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}if(o)return o;var r="MeshPhongMaterial",i={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var s=e.shading.toLowerCase();s==="phong"?r="MeshPhongMaterial":s==="basic"&&(r="MeshBasicMaterial")}e.blending!==undefined&&THREE[e.blending]!==undefined&&(i.blending=THREE[e.blending]);if(e.transparent!==undefined||e.opacity<1)i.transparent=e.transparent;e.depthTest!==undefined&&(i.depthTest=e.depthTest),e.depthWrite!==undefined&&(i.depthWrite=e.depthWrite),e.visible!==undefined&&(i.visible=e.visible),e.flipSided!==undefined&&(i.side=THREE.BackSide),e.doubleSided!==undefined&&(i.side=THREE.DoubleSide),e.wireframe!==undefined&&(i.wireframe=e.wireframe),e.vertexColors!==undefined&&(e.vertexColors==="face"?i.vertexColors=THREE.FaceColors:e.vertexColors&&(i.vertexColors=THREE.VertexColors)),e.colorDiffuse?i.color=n(e.colorDiffuse):e.DbgColor&&(i.color=e.DbgColor),e.colorSpecular&&(i.specular=n(e.colorSpecular)),e.colorAmbient&&(i.ambient=n(e.colorAmbient)),e.transparency&&(i.opacity=e.transparency),e.specularCoef&&(i.shininess=e.specularCoef),e.mapDiffuse&&(i.map=t(e.mapDiffuse)),e.mapLight&&(i.lightMap=t(e.mapLight)),e.mapBump&&(i.bumpMap=t(e.mapBump)),e.mapNormal&&(i.normalMap=t(e.mapNormal)),e.mapSpecular&&(i.specularMap=t(e.mapSpecular)),e.mapBumpScale&&(i.bumpScale=e.mapBumpScale);var o=new THREE[r](i);return o.name=e.DbgName,o}var r=new THREE.JSONLoader,i=e("../Geometry"),s=e("../Prefab"),o=e("../Material"),u=e("../Util");t.import=function(e,t,n){var i=[],u=n.createFolder("materials");_.each(t.materials,function(e){var t=f(e,function(e){var t=n.find(e);t||(t=n.find("textures/"+e));if(t)return t.data.getInstance()});i.push(t);var r=o.create(t),s=u.createFile(r.name,r)}),t.buffers||r.createModel(t,function(t){t.name=e;var r=a(t,i),o=s.create(r),u=n.createFile(o.name,o)})},t.importFromFile=function(e,n,r){var i=new FileReader;i.onload=function(i){if(i.target.readyState==FileReader.DONE){var s=u.parseFileName(e.name).base,o=t.import(s,JSON.parse(i.target.result),n);r&&r(o)}},i.readAsText(e)},t.importFromUrl=function(e,t,n){}}),define("Core/Assets/Importer/Zip",["../Geometry","../Prefab","../Material","../Shader","../FileSystem","../Texture","../TextureCube","../Util"],function(e,t,n){var r=new THREE.JSONLoader,i=e("../Geometry"),s=e("../Prefab"),o=e("../Material"),u=e("../Util")}),define("Core/Assets/Importer/Image",["../Texture"],function(e,t,n){var r=e("../Texture");t.import=function(e,t,n){var i=new Image;i.src=t;var s=new THREE.Texture(i);s.name=e;var o=n.createFolder("textures"),u=r.create(s);return o.createFile(u.name,u),u},t.importFromFile=function(e,n,r){var i=new FileReader;i.onload=function(i){if(i.target.readyState==FileReader.DONE){var s=t.import(e.name,i.target.result,n);r&&r(s)}},i.readAsDataURL(e)},t.importFromURL=function(e,t,n){}}),define("Core/Assets/Importer/DDS",["../Texture"],function(e,t,n){var r=e("../Texture");t.import=function(e,t,n){var i=THREE.ImageUtils.parseDDS(t,!0),s=new THREE.CompressedTexture;s.name=e,s.format=i.format,s.mipmaps=i.mipmaps,s.image.width=i.width,s.image.height=i.height,s.generateMipmaps=!1;var o=n.createFolder("textures"),u=r.create(s);return o.createFile(u.name,u),u},t.importFromFile=function(e,n,r){var i=new FileReader;i.onload=function(i){if(i.target.readyState==FileReader.DONE){var s=t.import(e.name,i.target.result,n);r&&r(s)}},i.readAsArrayBuffer(e)},t.importFromURL=function(e,t,n){}}),define("Core/UIBase/index",["./Button","./Checkbox","./Float","./Image","./Input","./Label","./Color","./Layer","./Link","./Node","./Panel","./Select","./Texture","./Tree","./Vector","./Video","./Tab","./Mixin/index","./Mixin/Collapsable","./Mixin/Scrollable","./Mixin/InputPin","./Mixin/Pin","./Mixin/OutputPin"],function(e,t,n){t.Button=e("./Button"),t.Checkbox=e("./Checkbox"),t.Float=e("./Float"),t.Image=e("./Image"),t.Input=e("./Input"),t.Label=e("./Label"),t.Color=e("./Color"),t.Layer=e("./Layer"),t.Link=e("./Link"),t.Node=e("./Node"),t.Panel=e("./Panel"),t.Select=e("./Select"),t.Texture=e("./Texture"),t.Tree=e("./Tree"),t.Vector=e("./Vector"),t.Video=e("./Video"),t.Tab=e("./Tab"),t.Mixin=e("./Mixin/index")}),define("Core/UIBase/Button",[],function(e,t,n){var r=Backbone.Model.extend({defaults:{name:"",label:""}}),i=Backbone.View.extend({tagName:"div",className:"lblend-button",template:'<button className="lblend-common-button" data-html="model.label"></button>',model:null,initialize:function(){this.model||(this.model=new r),this.render()},events:{"click button":"onclick"},render:function(){var e=this;e.$el.html(this.template),rivets.bind(this.$el,{model:this.model})},onclick:function(){this.trigger("click")}});t.View=i,t.Model=r,r.prototype.__viewconstructor__=i}),define("Core/UIBase/Checkbox",[],function(e,t,n){var r=Backbone.Model.extend({defaults:{name:"",value:!1}}),i=Backbone.View.extend({type:"CHECKBOX",tagName:"div",className:"lblend-checkbox",template:'<input type="checkbox" data-checked="model.value" data-name="model.name" /><label class="lblend-checkbox-label" data-html="model.name"></label>',model:null,initialize:function(){this.model||(this.model=new r);var e=this;this.render()},render:function(){var e=this;this.$el.html(this.template),rivets.bind(this.$el,{model:this.model})}});return r.prototype.__viewconstructor__=i,{Model:r,View:i}}),define("Core/UIBase/Float",[],function(e,t,n){var r=Backbone.Model.extend({defaults:{name:"",value:0,min:-1e5,max:1e5,step:0},initialize:function(){this.on("change:value",function(){_.isNaN(this.get("value"))&&this.set("value",0),this.get("value")<this.get("min")&&this.set("value",this.get("min")),this.get("value")>this.get("max")&&this.set("value",this.get("max"))},this),this.on("change:min",function(){this.get("min")>this.get("max")&&this.set("min",this.get("max")),this.get("min")>this.get("value")&&this.set("value",this.get("min"))}),this.on("change:max",function(){this.get("min")>this.get("max")&&this.set("max",this.get("min")),this.get("max")<this.get("value")&&this.set("value",this.get("max"))})}}),i=Backbone.View.extend({type:"FLOAT",model:null,tagName:"div",className:"lblend-float",template:'<div class="lblend-percent"></div><label>{{label}}</label> <span>{{value}}</span>',editModeTemplate:'<div class="lblend-percent"></div><input type="text" value="{{value}}" />',editMode:!1,events:{"click ":"enterEditMode","mousedown ":"enterDragMode"},initialize:function(){this.model||(this.model=new r),this.model.on("change:value",this.updateValue,this),this.model.on("change:max",this.updatePercent,this),this.model.on("change:min",this.updatePercent,this),this.model.on("change:name",function(){this.$el.find("label").html(this.model.get("name"))},this),this.render()},render:function(){this.editMode?this.$el.html(_.template(this.editModeTemplate,{value:Math.round(this.model.get("value")*1e3)/1e3})):this.$el.html(_.template(this.template,{label:this.model.get("name"),value:Math.round(this.model.get("value")*1e3)/1e3})),this.updatePercent()},updateValue:function(){this.editMode?this.$el.find("input").val(Math.round(this.model.get("value")*1e3)/1e3):this.$el.find("span").html(Math.round(this.model.get("value")*1e3)/1e3),this.updatePercent()},updatePercent:function(){var e=(this.model.get("value")-this.model.get("min"))/(this.model.get("max")-this.model.get("min"));this.$el.find(".lblend-percent").width(e*100+"%")},enterEditMode:function(){var e=this;if(this.editMode)return;this.editMode=!0,this.render();var t=this.$("input");t.focus(),t.blur(function(){e.editMode=!1,e.render()}),t.change(function(){e.model.set("value",parseFloat(this.value))})},enterDragMode:function(e){function r(e){var r=e.pageX,i=r-n;t.model.set("value",t.model.get("value")+i*t.model.get("step")),n=r}function i(e){$(document.body).unbind("mousemove",r),$(document.body).unbind("mouseup",i)}if(this.editMode)return!0;var t=this,n=e.pageX;$(document.body).bind("mousemove",r),$(document.body).mouseup("mouseup",i)}});t.View=i,t.Model=r,r.prototype.__viewconstructor__=i}),define("Core/UIBase/Image",[],function(e,t,n){var r=Backbone.Model.extend({defaults:{name:"",filename:"",src:null}}),i=Backbone.View.extend({type:"IMAGE",tagName:"div",className:"lblend-image",template:'<label class="lblend-image-label" data-html="model.name"></label>					<span class="lblend-image-filename" data-html="model.filename"></span>					<div class="lblend-image-wrapper">						<img data-src="model.src" />					</div>',model:null,initialize:function(){this.model||(this.model=new r),this.render(),this.on("dispose",function(){})},render:function(){this.$el.html(this.template),rivets.bind(this.$el,{model:this.model})}});t.View=i,t.Model=r,r.prototype.__viewconstructor__=i}),define("Core/UIBase/Input",[],function(e,t,n){var r=Backbone.Model.extend({defaults:{name:"",value:""}}),i=Backbone.View.extend({type:"INPUT",tagName:"div",className:"lblend-input",model:null,template:'<label class="lblend-input-label" data-html="model.name"></label><input type="text" data-value="model.value" />',initialize:function(){this.model||(this.model=new r);var e=this;this.render()},render:function(){var e=this;this.$el.html(this.template),rivets.bind(this.$el,{model:this.model})}});return r.prototype.__viewconstructor__=i,{Model:r,View:i}}),define("Core/UIBase/Label",[],function(e,t,n){var r=Backbone.Model.extend({defaults:{name:"",value:""}}),i=Backbone.View.extend({type:"LABEL",tagName:"div",className:"lblend-label",model:null,initialize:function(){this.model||(this.model=new r);var e=this;this.model.on("change:value",function(t,n){e.$el.html(n)}),this.render()},render:function(){var e=this;this.$el.html(this.model.get("value"))}});return r.prototype.__viewconstructor__=i,{Model:r,View:i}}),define("Core/UIBase/Color",[],function(e,t,n){var r=Backbone.Model.extend({defaults:{name:"",color:0}}),i=Backbone.View.extend({type:"COLOR",tagName:"div",className:"lblend-color",template:'<label class="lblend-color-label">{{label}}</label><div class="lblend-color-picker"></div>',$picker:null,colorPickerId:"",initialize:function(){this.model.on("change:name",function(e,t){this.$el.children(".lblend-color-label").html(t)},this),this.model.on("change:color",function(e,t,n){this.$picker.css({"background-color":"#"+t.toString(16)});if(n.triggeronce)return;$picker.ColorPickerSetColor(t)},this),this.render(),this.on("dispose",function(){$("#"+this.colorPickerId).remove()},this)},render:function(){var e=this;this.$el.html(_.template(this.template,{label:this.model.get("name")}));var t=this.$el.find(".lblend-color-picker"),n=this.model.get("color");t.ColorPicker({color:n.toString(16),onChange:function(t,n,r){e.model.set("color",n,{triggeronce:!0})}}),n&&t.css({"background-color":"#"+n.toString(16)}),this.$picker=t,this.colorPickerId=this.$picker.data("colorpickerId")}});return{Model:r,View:i}}),define("Core/UIBase/Layer",[],function(e,t,n){var r=Backbone.Collection.extend({name:""}),i=Backbone.Model.extend({defaults:{collection:new r}}),s=Backbone.View.extend({type:"LAYER",tagName:"div",className:"lblend-layer",collection:null,template:'<h5 class="lblend-layer-label">{{label}}</h5><div class="lblend-list"></div>',_views:[],initialize:function(){this.collection||(this.collection=new r),this.collection.on("add",this._addModel,this),this.collection.on("remove",this._removeModel,this),this.render(),this.on("dispose",function(){this.removeAll()},this)},$list:null,$label:null,render:function(){var e=this;e.el.innerHTML=_.template(this.template,{label:this.collection.name||""}),e._views=[],e.$list=e.$el.children(".lblend-list"),e.$label=e.$el.children(".lblend-layer-label"),e.collection.forEach(function(t,n){var r;if(t instanceof i){var s=t.get("collection");r=new s.__viewconstructor__({collection:s})}else r=new t.__viewconstructor__({model:t});r&&(r.parent=e,r.render(),e.$list.append(r.$el),e._views.push(r))})},_addModel:function(e){var t;if(e instanceof i){var n=e.get("collection");t=new n.__viewconstructor__({collection:n})}else t=new e.__viewconstructor__({model:e});t.parent=this,this.$list.append(t.$el),this._views.push(t)},_removeModel:function(e){_.each(this._views,function(t){if(t.model===e||t.collection===e.get("collection"))_.without(this._views,t),t.$el.remove()})},appendView:function(e){e.parent&&e.parent.removeView(e);if(e.model)this.collection.push(e.model,{silent:!0});else if(e.collection){var t=new i({collection:e.collection});this.collection.push(t,{silent:!0})}e&&(e.parent=this,this.$list.append(e.$el),this._views.push(e))},removeView:function(e){var t=_.indexOf(this._views,e);if(t<0)return null;_.without(this._views,e),e.$el.remove(),this.collection.remove(this.collection.at(t),{silent:!0}),e.trigger("dispose")},removeAll:function(){_.each(this._views,function(e){e.$el.remove(),e.trigger("dispose")}),this._views=[],this.collection.reset()},findByType:function(e){function r(t){t._views&&_.each(t._views,function(e,t){r(e)}),e.toUpperCase()==t.type&&n.push(t)}var t=this,n=[];return r(this),n},findByName:function(e){function r(t){t._views&&_.each(t._views,function(e,t){r(e)}),t.model?t.model.get("name")==e&&(n=t):t.collection&&t.collection.name==e&&(n=t)}var t=this,n=null;return r(this),n},setName:function(e){this.collection.name=e,this.$el.children("h5.lblend-layer-label").html(e)},hideLabel:function(){this.$el.children("h5").css({display:"none"})},showLabel:function(){this.$el.children("h5").css({display:"auto"})}});t.Collection=r,t.WrapperModel=i,t.View=s,r.prototype.__viewconstructor__=s}),define("Core/UIBase/Link",[],function(e,t,n){var r=Backbone.Model.extend({defaults:{source:{left:0,top:0},target:{left:0,top:0}}}),i=Backbone.View.extend({type:"LINK",model:null,initialize:function(){this.model||(this.model=new r),this.model.on("change:source",function(){this._updatePath()},this),this.model.on("change:target",function(){this._updatePath()},this)},render:function(e){var t=this.model.get("source")||{left:0,top:0},n=this.model.get("target")||t;this.el=e.create("path"),e.attr(this.el,"d",this._getPathString(t,n)),e.attr(this.el,{stroke:"#c8c828","stroke-width":2,fill:"none"}),this._svg=e},_updatePath:function(){if(!this._svg)return;var e=this.model.get("source")||{left:0,top:0},t=this.model.get("target")||e;this._svg.attr(this.el,"d",this._getPathString(e,t))},_getPathString:function(e,t){var n={left:e.left+60,top:e.top},r={left:t.left-60,top:t.top};return _.template("M {{p1x}} {{p1y}} C {{c1x}} {{c1y}} {{c2x}} {{c2y}} {{p2x}} {{p2y}}",{p1x:e.left,p1y:e.top,c1x:n.left,c1y:n.top,c2x:r.left,c2y:r.top,p2x:t.left,p2y:t.top})},remove:function(){this.el.parentNode.removeChild(this.el)}});t.View=i,t.Model=r,r.prototype.__viewconstructor__=i}),define("Core/UIBase/Node",["./Layer"],function(e,t,n){var r=e("./Layer"),i=r.Collection.extend({}),s=r.View.extend({className:"lblend-node",template:'<h5 class="lblend-node-label">{{label}}</h5><div class="lblend-list"></div><div class="lblend-close" title="close"></div>',collection:null,render:function(){var e=this;r.View.prototype.render.call(this),this.$el.draggable({scrollSensitivity:40,stack:".lblend-node",scrollSpeed:60,opacity:.5,handle:"h5",cursor:"move",drag:function(){e.trigger("drag")},start:function(){e.trigger("dragstart")}}),this.$el.css("position","absolute"),this.cachePinViews(),this.$el.find(".lblend-close").click(function(){e.trigger("close")})},cachePinViews:function(){this._inputPinViews=this.findByType("INPUTPIN"),this._outputPinViews=this.findByType("OUTPUTPIN")},setName:function(e){this.collection.name=e,this.$el.find("h5.lblend-node-label").html(e)}});t.Collection=i,t.View=s,i.prototype.__viewconstructor__=s}),define("Core/UIBase/Panel",["./Layer"],function(e,t,n){var r=e("./Layer"),i=r.Collection.extend({}),s=r.View.extend({type:"PANEL",tagName:"div",className:"lblend-panel",template:'<h5 class="lblend-panel-label">{{label}}</h5><div class="lblend-list"></div>',collection:null,render:function(){var e=this;r.View.prototype.render.call(this)},setName:function(e){this.collection.name=e,this.$el.find("h5.lblend-panel-label").html(e)}});t.Collection=i,t.View=s,i.prototype.__viewconstructor__=s}),define("Core/UIBase/Select",[],function(e,t,n){var r=Backbone.Model.extend({defaults:{name:"",value:"",html:"",selected:!1}}),i=Backbone.Collection.extend({select:function(e){this.forEach(function(t){t.get("value")==e?t.set("selected",!0):t.set("selected",!1)})}}),s=Backbone.View.extend({type:"SELECT",tagName:"div",className:"lblend-select",template:'<label class="lblend-select-label">{{label}}</label><a class="lblend-select-button lblend-common-button"></a>',collection:null,events:{"click .lblend-select-button":"toggle"},inSelect:!1,initialize:function(){this.collection||(this.collection=new i);var e=this;this.collection.on("add",this.add,this),this.collection.on("change:selected",function(e,t){t&&this.trigger("change",e)},this),this.on("dispose",function(){$(".lblend-select-dropdown-list").remove()}),this.render()},render:function(){var e=this;this.$el.html(_.template(this.template,{label:this.collection.name||""}))},add:function(e){this.collection.where({selected:true}).length==0&&this.select(e.get("value"))},toggle:function(){if(this.inSelect)$(".lblend-select-dropdown-list").remove(),this.inSelect=!1;else{var e=this;$(".lblend-select-dropdown-list").remove(),$ul=$('<ul class="lblend-select-dropdown-list"></ul>'),this.collection.forEach(function(t){$ul.append(e.createItem(t))});var t=this.$el.find(".lblend-select-button"),n=t.offset();$(document.body).append($ul),$ul.css({position:"absolute"}),$ul.offset({left:n.left,top:n.top+t.outerHeight()+3}),this.inSelect=!0}},createItem:function(e){var t=this,n=$("<li></li>");return n.data("value",e.get("value")),n.html(e.get("html")),n.click(function(){t.select(e.get("value")),t.toggle()}),e.get("selected")&&n.addClass("selected"),n},setName:function(e){this.collection.name=e,this.$el.children("label.lblend-select-label").html(e)},select:function(e){this.collection.select(e);var t=$(".lblend-select-dropdown-list"),n=t.children("li"),r=this;n.removeClass("selected"),t.children("li").each(function(){var t=$(this);t.data("value")==e&&t.addClass("selected")});var i=this.collection.where({value:e})[0];i&&this.$el.find(".lblend-select-button").html(i.get("html"))}});return i.prototype.__viewconstructor__=s,{Collection:i,View:s}}),define("Core/UIBase/Texture",["./Float"],function(e,t,n){var r=e("./Float"),i=0,s=Backbone.Model.extend({defaults:{name:"",filename:"none",texture:null}}),o=Backbone.View.extend({type:"TEXTURE",tagName:"div",className:"lblend-texture",template:'<label class="lblend-texture-label" data-html="model.name"></label><span class="lblend-texture-filename" data-html="model.filename"></span>',popupTemplate:'<div class="lblend-texture-popup"><div class="lblend-texture-popup-image"></div></div>',model:null,$popup:null,popup:null,textureID:0,events:{"click .lblend-texture-filename":"toggleImage"},initialize:function(){this.model||(this.model=new s),this.textureID=i++,this.render(),this.model.on("change:texture",function(e,t){this.updateTexture()},this),this.on("dispose",function(){$("#texturepopup_"+this.textureID).remove()})},render:function(){this.$el.html(this.template),rivets.bind(this.$el,{model:this.model}),this.$popup=$(this.popupTemplate),this.popup=this.$popup[0],this.$popup.attr("id","texturepopup_"+this.textureID),this.updateTexture()},toggleImage:function(){var e=$("#texturepopup_"+this.textureID);if(e.length)e.remove();else{var t=this.$el.offset();this.$popup.css({left:t.left,top:t.top+this.$el.height()+2}),$(document.body).append(this.$popup)}},updateTexture:function(){var e=this.$popup.find(".lblend-texture-popup-image");e.find("img").remove(),this.model.get("texture")?e.append(this.model.get("texture").image):e.append('<img class="lblend-texture-default" />')}});t.View=o,t.Model=s,s.prototype.__viewconstructor__=o}),define("Core/UIBase/Tree",[],function(e,t,n){var r=[],i=Backbone.Model.extend({defaults:{json:[]}}),s=function(e){this.type="file",this.name=e,this.owner="",this.acceptConfig={},this.$el=null};_.extend(s.prototype,Backbone.Events),s.prototype.getRoot=function(){var e=this;while(e.parent)e=e.parent;return e},s.prototype.genElement=function(){var e=_.template('<li class="lblend-tree-file">						<span class="lblend-tree-title" draggable="true">							<span class="{{icon}}"></span>							<a>{{name}}</a>						</span>					</li>',{icon:this.icon,name:this.name}),t=$(e);this.$el=t,t.data("path",this.getPath());var n=this;return t[0].addEventListener("dragstart",function(e){e.stopPropagation(),e.dataTransfer.setData("text/plain",JSON.stringify(n.toJSON()))},!1),t},s.prototype.select=function(e){this.$el.addClass("active"),e||this.getRoot().trigger("selected:node",this)},s.prototype.unselect=function(){this.$el.hasClass("active")&&(this.$el.removeClass("active"),this.getRoot().trigger("unselected:node",this))},s.prototype.getPath=function(){return this.parent?this.parent.getPath()+this.name:this.name},s.prototype.setName=function(e,t){t||this.getRoot().trigger("updated:name",this,e),this.name=e,this.$el&&this.$el.children(".lblend-tree-title").find("a").html(e),this.$el.data("path",this.getPath())},s.prototype.toJSON=function(){var e={type:this.type,name:this.name,path:this.getPath(),icon:this.icon,owner:this.owner,dataSource:_.isFunction(this.dataSource)?this.dataSource():this.dataSource,dataType:this.dataType};return e};var o=function(e){this.name=e,this.type="folder",this.owner="",this.children=[],this.$el=null,this.$sub=null,this.acceptConfig={"default":{accept:function(e){if(!(e instanceof FileList)&&e.owner==this.owner)return!0},accepted:function(e){var t=this.getRoot().find(e.path);t&&t.parent!=self&&this.add(t)}}}};_.extend(o.prototype,Backbone.Events),o.prototype.setName=function(e,t){t||this.getRoot().trigger("updated:name",this,e),this.name=e,this.$el&&this.$el.children(".lblend-tree-title").find("a").html(e),this.$el.data("path",this.getPath())},o.prototype.getRoot=function(){var e=this;while(e.parent)e=e.parent;return e},o.prototype.add=function(e,t){var n=!1;if(e.parent){n=!0;var r=e.parent;if(e.parent==this)return;e.parent.remove(e,!0)}this.children.push(e),e.parent=this,this.$sub.append(e.genElement()),e.owner=this.owner,t||(n?this.getRoot().trigger("moved:node",this,r,e):this.getRoot().trigger("added:node",this,e))},o.prototype.remove=function(e,t){_.isString(e)&&(e=this.find(e)),this.silent||this.getRoot().trigger("removed:node",this,e),e.parent=null,_.without(this.children,e),e.$el.remove()},o.prototype.getPath=function(){return this.parent?this.parent.getPath()+this.name+"/":this.name+"/"},o.prototype.genElement=function(){var e=_.template('<li class="lblend-tree-folder">						<span class="lblend-tree-title" draggable="true">							<span class="icon-small icon-unfold button-toggle-collapse"></span>							<span class="{{icon}}"></span>							<a>{{name}}</a>						</span>						<ul>						</ul>					</li>',{icon:this.icon,name:this.name}),t=$(e),n=t.children("ul");t.data("path",this.getPath());var r=this;return _.each(this.children,function(e){n.append(e.genElement())}),t[0].addEventListener("dragstart",function(e){e.stopPropagation(),e.dataTransfer.setData("text/plain",JSON.stringify(r.toJSON()))},!1),this.$el=t,this.$sub=n,t},o.prototype.accept=function(e,t){this.acceptConfig.push({accept:t})},o.prototype.select=function(e){this.$el.addClass("active"),this.selected=!0,e||this.getRoot().trigger("selected:node",this)},o.prototype.unselect=function(){this.$el.hasClass("active")&&(this.$el.removeClass("active"),this.selected=!1,this.getRoot().trigger("unselected:node",this))},o.prototype.toggleCollapase=function(){this.$el.toggleClass("collapse");var e=this.$el.find(".button-toggle-collapse");this.$el.hasClass("collapse")?(e.removeClass("icon-unfold"),e.addClass("icon-fold")):(e.removeClass("icon-fold"),e.addClass("icon-unfold"))},o.prototype.traverse=function(e){e(this),_.each(this.children,function(t){t.traverse?t.traverse(e):e(t)})},o.prototype.find=function(e){var t=this;return e.charAt(0)=="/"&&(e=e.substring(1),t=this.getRoot()),_.reduce(_.compact(e.split("/")),function(e,t){if(!e)return;return t==".."?e.parent:!t||t=="."?e:_.find(e.children,function(e){return e.name==t})},t)},o.prototype.createFromJSON=function(e){var t=this;e=_.isArray(e)?e:[e],_.each(e,function(e){if(e.type=="folder"){var n=new o(e.name);n.icon=e.icon,n.dataSource=e.dataSource,n.dataType=e.dataType,t.add(n),_.each(e.children,function(e){n.createFromJSON(e)})}else if(e.type=="file"){var r=new s(e.name);r.icon=e.icon,r.source=e.source,r.targetType=e.targetType,t.add(r)}})},o.prototype.toJSON=function(){var e={type:this.type,name:this.name,path:this.getPath(),icon:this.icon,owner:this.owner,dataSource:_.isFunction(this.dataSource)?this.dataSource():this.dataSource,dataType:this.dataType,children:[]};return _.each(this.children,function(e){this.children.push(e.toJSON())}),e},o.prototype.createFolder=function(e,t){e=_.compact(e.split("/"));var n=_.reduce(e,function(e,n){var r=e.find(n);return r||(r=new o(n),e.add(r,t)),r},this);return t||this.getRoot().trigger("created:folder",this,n),n},o.prototype.createFile=function(e,t){dir=_.compact(e.split("/"));var n=dir.pop(),r=this.createFolder(dir.join("/")),i=r.find(n);return i||(i=new s(n),r.add(i,t),t||this.getRoot().trigger("created:file",this,i)),i};var u=function(){o.call(this),this.name="/"};u.prototype=new o,u.prototype.getPath=function(){return"/"},u.prototype.genElement=function(){var e=$('<div class="lblend-tree-root">						<ul></ul>					</div>'),t=e.find("ul");return this.$sub=t,this.$el=e,_.each(this.children,function(e){t.append(e.genElement())}),e};var a=Backbone.View.extend({type:"THREE",className:"lblend-tree",tagName:"div",root:null,events:{"dragenter li":"dragenterHandler","dragleave li":"dragleaveHandler","drop li":"dropHandler","click .lblend-tree-title":"clickTitleHanlder"},initialize:function(){var e=this;this.model||(this.model=new i),this.root||(this.root=new u),this.model.on("change:json",function(){this.render()},this),this.root.on("all",function(){this.trigger.apply(this,arguments)},this),this.render(),this._dragenter=[],this._dragleave=[],this._drop=[],this.drop(function(t,n){var r=e.find($(this).data("path"));_.each(r.acceptConfig,function(e){e.accept.call(r,t)&&e.accepted.call(r,t)})}),r.push(this),this.on("dispose",function(){_.without(r,e)})},render:function(){this.root.createFromJSON(this.model.get("json")),this.$el.html(""),this.$el.append(this.root.genElement())},clickTitleHanlder:function(e){var t=$(e.currentTarget).parent(),n=t.data("path"),r=this.find(n);r.select(),e.shiftKey||this.root.traverse(function(e){e.unselect()}),r.select(),r.type=="folder"&&r.toggleCollapase(),this.trigger("click:node",r)},find:function(e){return this.root.find(e)},remove:function(e,t){var n=this.find(e);n&&n.parent.remove(n,t)},select:function(e,t,n){t||this.root.traverse(function(e){e.unselect()}),this.root.find(e).select(n)},_dragenter:[],_dragleave:[],_drop:[],dragenterHandler:function(e){e.stopPropagation(),e.preventDefault(),$(e.currentTarget).addClass("lblend-tree-dragover"),_.each(this._dragenter,function(t){t.call(e.currentTarget,e)})},dragleaveHandler:function(e){e.stopPropagation(),e.preventDefault(),$(e.currentTarget).removeClass("lblend-tree-dragover");var t=this;_.each(this._dragleave,function(t){t.call(e.currentTarget,e)})},dropHandler:function(e){e.stopPropagation(),e.preventDefault(),$(e.currentTarget).removeClass("lblend-tree-dragover");var t;e.dataTransfer.files.length?t=e.dataTransfer.files:t=JSON.parse(e.dataTransfer.getData("text/plain")),_.each(this._drop,function(n){n.call(e.currentTarget,t,e)})},drop:function(e,t,n){e&&this._drop.push(e),t&&this._dragenter.push(t),n&&this._dragleave.push(n)}});i.prototype.__viewconstructor__=a,t.Model=i,t.View=a,t.File=s,t.Folder=o,t.Root=u}),define("Core/UIBase/Vector",["./Float"],function(e,t,n){var r=e("./Float"),i=Backbone.Collection.extend({name:"",model:r.Model}),s=Backbone.View.extend({type:"VECTOR",tagName:"div",className:"lblend-vector",collection:null,labelTemplate:'<label class="lblend-vector-label">{{label}}</label><div class="lblend-list"></div>',initialize:function(){this.collection||(this.collection=new i);var e=this;this.collection.on("add",function(t){var n=new r.View({model:t});e.$el.children(".lblend-list").append(n.$el)}),this.render()},render:function(){var e=this;e.el.innerHTML=_.template(this.labelTemplate,{label:this.collection.label||this.collection.name||""});var t=e.$el.children(".lblend-list");e.collection.forEach(function(e,n){var i=new r.View({model:e});i.render(),t.append(i.$el)})},setName:function(e){this.collection.name=e,this.$el.find("label.lblend-vector-label").html(e)}});t.Collection=i,t.View=s,i.prototype.__viewconstructor__=s}),define("Core/UIBase/Video",[],function(e,t,n){var r=Backbone.Model.extend({defaults:{name:"",video:null}}),i=Backbone.View.extend({type:"VIDEO",model:null,tagName:"div",className:"lblend-video",template:"<label>{{label}}</label><br />",initialize:function(){this.model||(this.model=new r),this.model.on("change:video",function(){this.el&&(this.$el.find("video").remove(),this.model.get("video")?this.el.appendChild(this.model.get("video")):this.$el.append('<video class="lblend-video-default" />'))},this),this.model.on("change:name",function(){this.$el.find("label").html(this.model.get("name"))},this),this.render()},render:function(){this.el.innerHTML=_.template(this.template,{label:this.model.get("name")||""}),this.model.get("video")?this.el.appendChild(this.model.get("video")):this.$el.append('<video class="lblend-video-default" />')}});t.Model=r,t.View=i,r.prototype.__viewconstructor__=i}),define("Core/UIBase/Tab",["./Layer"],function(e,t){var n=e("./Layer"),r=n.Collection.extend({}),i=Backbone.View.extend({type:"TAB",className:"lblend-tab",template:'<ul class="lblend-tab-tabs"></ul><div class="lblend-list"></div>',tabs:null,initialize:function(){var e=this;this.tabs=new Backbone.Collection,this.tabs.on("add",function(t){e.renderTabs(),t.on("change:active",function(){t.get("active")?(t.get("$el").addClass("active"),t.get("view").$el.css("display","block")):(t.get("$el").removeClass("active"),t.get("view").$el.css("display","none"))}),e.tabs.forEach(function(e){e.set("active",!1)}),t.set("active",!0)}),this.tabs.on("remove",function(t){e.renderTabs()}),n.View.prototype.initialize.call(this)},render:function(){n.View.prototype.render.call(this),this.renderTabs()},renderTabs:function(){var e=this,t=this.$el.children(".lblend-tab-tabs");t.html(""),this.tabs.forEach(function(n){var r=$("<li>"+n.get("name")+"</li>");r.click(function(){e.active(n.get("name"))}),t.append(r),n.set("$el",r)})},_addModel:function(e){n.View.prototype._addModel.call(this,e);var t=_.last(this._views);t.hideLabel();var r=s(e);this.tabs.add({name:r,active:!1,view:t})},_removeModel:function(e){n.View.prototype._removeModel.call(this,e);var t=s(e);this.tabs.remove(this.tabs.where({name:t})[0])},appendView:function(e){n.View.prototype.appendView.call(this,e);var t=o(e);this.tabs.add({name:t,active:!1,view:e,$el:$("<li>"+t+"</li>")})},removeView:function(e){n.View.prototype.removeView.call(this,e)},active:function(e){var t;this.tabs.forEach(function(n){n.get("name")==e?(n.set("active",!0),t=n.get("view")):n.set("active",!1)}),t&&t.getMenuConfigs}}),s=function(e){var t;if(e instanceof n.WrapperModel){var r=e.get("collection");t=r.name}else t=e.get("name");return t},o=function(e){return e.collection?e.collection.name:e.model.get("name")};t.Collection=r,t.View=i,r.prototype.__viewconstructor__=i}),define("Core/UIBase/Mixin/index",["./Collapsable","./Scrollable","./InputPin","./Pin","./OutputPin"],function(e,t,n){t.Collapsable=e("./Collapsable"),t.Scrollable=e("./Scrollable"),t.InputPin=e("./InputPin"),t.OutputPin=e("./OutputPin"),t.Pin=e("./Pin")}),define("Core/UIBase/Mixin/Collapsable",[],function(e,t,n){t.applyTo=function(e){function r(){var t=e.$el.children("h5");t.length||(t=e.$el.children("label")),t.css("position")!="absolute"&&t.css("position","relative"),t.append(n),t.css("padding-left","20px"),t.bind("click",e.toggle),n.addClass(e.collapase?"fold":"unfold");var r=e.$el.children(".lblend-list");r.css({"overflow-y":"hidden"})}var t=this;e.mixin||(e.mixin=[]);if(_.indexOf(e.mixin,t.tag)>0)return;e.mixin.push(t.tag);var n=$(_.template('<div class="{{className}}"></div>"',{className:t.className})),i=e.render;_.extend(e,{collapse:!1,render:function(){i.call(e),r()},toggle:function(){e.collapase?e.unfold():e.fold()},fold:function(){this.$el.find(".lblend-list").slideUp(),n.removeClass("unfold"),n.addClass("fold"),this.collapase=!0},unfold:function(){this.$el.find(".lblend-list").slideDown(),n.addClass("unfold"),n.removeClass("fold"),this.collapase=!1},back:function(){var t=e.$el.children("label");n.remove(),e.render=i,delete e.collapse,delete e.toggle,delete e.fold,delete e.unfold}}),r()},t.className="lblend-collapsable",t.tag="COLLAPSABLE"}),define("Core/UIBase/Mixin/Scrollable",[],function(e,t,n){t.applyTo=function(e){function g(){e.$el.css("overflow","hidden"),u=e.$el.children(".lblend-list"),a=e.$el.children("h5"),f={top:u.position().top,left:u.position().left},e.$el.append(n),e.$el.append(r),m&&clearInterval(m),setInterval(function(){y()},500),e.$el.mousewheel(function(e,t){b(t*20)})}function y(){p=e.$el.height()-f.top,h=e.$el.width(),d=u.width(),v=u.height(),l=h/d,c=p/v,l>=1?n.css("display","none"):(n.css("display","block"),i.width(l*e.$el.width())),c>=1?r.css("display","none"):(r.css("display","block"),s.height(c*e.$el.height()))}function b(e){var t=u.position().top+e,n=Math.abs(t/(v-p));t>=f.top&&(n=0),n>=1&&(n=1),E(n),S(n)}function w(e){var t=u.position().left+e,n=Math.abs(t/(d-h));t>=f.left&&(t=f.left,n=Math.abs(t/(d-h))),n>=1&&(n=1),x(n),T(n)}function E(e){var t=s.height(),n=r.height(),i=(n-t)*e;s.css("top",i)}function S(t){var n=(v-p)*t,r=e.$el.offset().top;u.offset({top:-n+f.top+r})}function x(e){var t=i.width(),r=n.width(),s=(r-t)*e;i.css("left",s)}function T(t){var n=(d-h)*t,r=e.$el.offset().left;u.offset({left:-n+f.left+r})}var t=this;e.mixin||(e.mixin=[]);if(_.indexOf(e.mixin,t.tag)>0)return;e.mixin.push(t.tag);var n=$('<div class="lblend-scrollbar-x"><div class="lblend-scrollbar-thumb"></div></div>'),r=$('<div class="lblend-scrollbar-y"><div class="lblend-scrollbar-thumb"></div></div>'),i=n.find(".lblend-scrollbar-thumb"),s=r.find(".lblend-scrollbar-thumb");n.mousewheel(function(e,t){e.stopPropagation(),w(t*20)}),r.mousewheel(function(e,t){e.stopPropagation(),b(t*20)});var o=e.render,u,a,f,l,c,h,p,d,v;i.draggable({axis:"x",containment:"parent",drag:function(e,t){var r=t.position.left,s=i.width(),o=n.width();if(o>s){var u=r/(o-s);T(u)}}}),s.draggable({axis:"y",containment:"parent",drag:function(e,t){var n=t.position.top,i=s.height(),o=r.height();if(o>i){var u=n/(o-i);S(u)}}});var m;e.on("dispose",function(){m&&clearInterval(m)}),_.extend(e,{render:function(){o.call(this),g()},back:function(){},scrollTo:scrollTo}),g()},t.className="lblend-scrollable",t.tag="SCROLLABLE"}),define("Core/UIBase/Mixin/InputPin",["./Pin"],function(e,t,n){var r=e("./Pin");_.extend(t,{className:"lblend-pin-input",tag:"INPUTPIN"}),_.defaults(t,r)}),define("Core/UIBase/Mixin/Pin",[],function(e,t,n){t.applyTo=function(e){function r(){n=$(_.template('<div class="{{className}}"></div>',{className:t.className}))}function i(){e.$el.css("position")!="absolute"&&e.$el.css("position","relative"),e.$el.append(n)}var t=this;e.mixin||(e.mixin=[]);if(_.indexOf(e.mixin,t.tag)>=0)return;e.mixin.push(t.tag);var n;r(),i();var s=e.render;_.extend(e,{$pin:n,render:function(){s.call(e),i()},getPosition:function(e){var t=n.offset(),e=e||{left:0,top:0},r=n.width(),i=n.height();return{left:t.left-e.left+r/2,top:t.top-e.top+i/2}},back:function(){delete this.$pin,delete this.getPosition,n.remove(),e.render=s}})},t.className="lblend-pin",t.tag="PIN"}),define("Core/UIBase/Mixin/OutputPin",["./Pin"],function(e,t,n){var r=e("./Pin");_.extend(t,{className:"lblend-pin-output",tag:"OUTPUTPIN"}),_.defaults(t,r)}),define("Core/index",["./Hub","./svg","./Assets/index","./Assets/Geometry","./Assets/Material","./Assets/Shader","./Assets/FileSystem","./Assets/Prefab","./Assets/Texture","./Assets/TextureCube","./Assets/Util","./Assets/Importer/index","./Assets/Importer/Binary","./Assets/Importer/Collada","./Assets/Importer/JSON","./Assets/Importer/Zip","./Assets/Importer/Image","./Assets/Importer/DDS","./UIBase/index","./UIBase/Button","./UIBase/Checkbox","./UIBase/Float","./UIBase/Image","./UIBase/Input","./UIBase/Label","./UIBase/Color","./UIBase/Layer","./UIBase/Link","./UIBase/Node","./UIBase/Panel","./UIBase/Select","./UIBase/Texture","./UIBase/Tree","./UIBase/Vector","./UIBase/Video","./UIBase/Tab","./UIBase/Mixin/index","./UIBase/Mixin/Collapsable","./UIBase/Mixin/Scrollable","./UIBase/Mixin/InputPin","./UIBase/Mixin/Pin","./UIBase/Mixin/OutputPin"],function(e,t,n){t.Hub=e("./Hub"),t.svg=e("./svg"),t.Assets=e("./Assets/index"),t.UIBase=e("./UIBase/index")});